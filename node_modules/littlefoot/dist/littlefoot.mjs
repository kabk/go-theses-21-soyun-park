import{getStyle as t}from"@pacote/get-style";import{pixels as e}from"@pacote/pixels";import{throttle as o}from"@pacote/throttle";import{off as n,on as i}from"delegated-events";function r(t,e){t.classList.add(e)}function s(t,e){t.classList.remove(e)}function a(t){var e;null===(e=t.parentNode)||void 0===e||e.removeChild(t)}function l(t){const e=t.offsetHeight,o=t.getBoundingClientRect().top+e/2;return{top:o,bottom:window.innerHeight-o}}function c(e){const o=parseFloat(t(e,"marginLeft")),n=e.offsetWidth-o;return(e.getBoundingClientRect().left+n/2)/window.innerWidth}function d(e,o){const n=2*parseInt(t(e,"marginTop"),10)+e.offsetHeight;return o.bottom<n&&o.bottom<o.top?"top":"bottom"}const f=t=>!!t.parentElement;function u({id:o,button:n,content:i,host:u,popover:m,wrapper:p}){let v=!1,h=0;return{id:o,activate:o=>{var s;n.setAttribute("aria-expanded","true"),r(n,"is-changing"),r(n,"is-active"),n.insertAdjacentElement("afterend",m),m.style.maxWidth=document.body.clientWidth+"px",s=i,h=Math.round(e(t(s,"maxHeight"),s)),null==o||o(m,n)},dismiss:t=>{n.setAttribute("aria-expanded","false"),r(n,"is-changing"),s(n,"is-active"),s(m,"is-active"),null==t||t(m,n)},isActive:()=>n.classList.contains("is-active"),isReady:()=>!n.classList.contains("is-changing"),isHovered:()=>v,ready:()=>{r(m,"is-active"),s(n,"is-changing")},remove:()=>{a(m),s(n,"is-changing")},reposition:()=>{f(m)&&(i.style.maxHeight=function(e,o,n){const i=l(o),r=d(e,i),s=parseInt(t(e,"marginTop"),10);return Math.min(n,i[r]-s-15)}(m,n,h)+"px",function(t,e){const o=d(t,l(e)),n=t.dataset.footnotePosition;if(n!==o){t.dataset.footnotePosition=o,s(t,"is-positioned-"+n),r(t,"is-positioned-"+o);const i=100*c(e)+"%",a="top"===o?"100%":"0";t.style.transformOrigin=i+" "+a}}(m,n),m.offsetHeight<i.scrollHeight?(r(m,"is-scrollable"),i.setAttribute("tabindex","0")):(s(m,"is-scrollable"),i.removeAttribute("tabindex")))},resize:()=>{f(m)&&(m.style.left=function(e,o){const n=e.offsetWidth;return-c(o)*n+parseInt(t(o,"marginLeft"),10)+o.offsetWidth/2}(i,n)+"px",p.style.maxWidth=i.offsetWidth+"px",function(t,e){const o=t.querySelector(".littlefoot-footnote__tooltip");o&&(o.style.left=100*c(e)+"%")}(m,n))},startHovering:()=>{v=!0},stopHovering:()=>{v=!1},destroy:()=>a(u)}}function m(t,e){t.addEventListener("wheel",o((t=>e=>{const o=e.currentTarget,n=-e.deltaY;n>0&&s(t,"is-fully-scrolled"),o&&n<=0&&n<o.clientHeight+o.scrollTop-o.scrollHeight&&r(t,"is-fully-scrolled")})(e),16))}const p=t=>r(t,"footnote-print-only");function v(t,e){return Array.from(t.querySelectorAll(e))}function h(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function g(t){const e=document.createElement("div");return e.innerHTML=t,e.firstElementChild}function y(t){return void 0!==t}function b(t){const e=(o=t,n=":not(.footnote-print-only)",Array.from(o.children).filter(t=>8!==t.nodeType&&(!n||t.matches(n))));var o,n;const i=e.filter(t=>"HR"===t.tagName);e.length===i.length&&(i.concat(t).forEach(p),b(t.parentElement))}function E(t){const e=t.parentElement;a(t);const o=null==e?void 0:e.innerHTML.replace("[]","").replace("&nbsp;"," ").trim();e&&!o&&E(e)}function w(t,e){const o=g(t.body.outerHTML);v(o,'[href$="#'+t.referenceId+'"]').forEach(E);const n=o.innerHTML.trim();return{original:t,data:{id:""+(e+1),number:e+1,reference:"lf-"+t.referenceId,content:n.startsWith("<")?n:"<p>"+n+"</p>"}}}function H(t){const e=/<%=?\s*(\w+?)\s*%>/g;return o=>t.replace(e,(t,e)=>{var n;return String(null!==(n=o[e])&&void 0!==n?n:"")})}function x(t){const{allowDuplicates:e,anchorParentSelector:o,anchorPattern:n,buttonTemplate:i,contentTemplate:r,footnoteSelector:a,numberResetSelector:l,scope:c}=t,d=function(t,e,o){return v(t,o+' a[href*="#"]').filter(t=>(t.href+t.rel).match(e))}(document,n,c).map(function(t,e,o,n){const i=[];return r=>{const s="#"+r.href.split("#")[1].replace(/[:.+~*[\]]/g,"\\$&"),a=v(t,s).find(t=>e||!i.includes(t)),l=null==a?void 0:a.closest(n);if(l){i.push(l);const t=r.closest(o)||r;return{reference:t,referenceId:t.id||r.id,body:l}}}}(document,e,o,a)).filter(y).map(w).map(l?(t=>{let e=0,o=null;return({original:n,data:i})=>{const r=n.reference.closest(t);return e=o===r?e+1:1,o=r,{original:n,data:Object.assign(Object.assign({},i),{number:e})}}})(l):t=>t).map(function(t,e){const o=H(t),n=H(e);return({original:t,data:e})=>{const i=e.id,r=g(`<span class="littlefoot-footnote__host">${o(e)}</span>`),s=r.firstElementChild;s.dataset.footnoteButton="",s.dataset.footnoteId=i,s.dataset.footnoteNumber=""+e.number;const a=g(n(e));a.dataset.footnotePopover="",a.dataset.footnoteId=i;const l=h(a,"littlefoot-footnote__wrapper"),c=h(a,"littlefoot-footnote__content");return m(c,a),{original:t,data:e,id:i,button:s,host:r,popover:a,content:c,wrapper:l}}}(i,r));d.forEach(({original:t,host:e})=>{p(t.reference),p(t.body),b(t.body.parentElement),function(t,e){t.insertAdjacentElement("beforebegin",e)}(t.reference,e)});const f=d.map(u);return{footnotes:f,unmount(){f.forEach(t=>t.destroy()),v(document,".footnote-print-only").forEach(t=>s(t,"footnote-print-only"))}}}const A={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:'<aside class="littlefoot-footnote" id="fncontent:<% id %>"><div class="littlefoot-footnote__wrapper"><div class="littlefoot-footnote__content"><% content %></div></div><div class="littlefoot-footnote__tooltip"></div></aside>',buttonTemplate:'<button class="littlefoot-footnote__button littlefoot-footnote__button__ellipsis" id="<% reference %>" title="See Footnote <% number %>" aria-expanded="false"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};const _=(t,e)=>t.target.closest(e),T=t=>null==t?void 0:t.dataset.footnoteId,D=t=>e=>{e.preventDefault();const o=_(e,"[data-footnote-id]"),n=T(o);n&&t(n)},L=document.addEventListener,S=document.removeEventListener,M=window.addEventListener,k=window.removeEventListener;function C(t){const e=(r=t.toggle,s=t.dismissAll,t=>{const e=_(t,"[data-footnote-button]"),o=T(e);o?r(o):_(t,"[data-footnote-popover]")||s()});var r,s;const a=(l=t.dismissAll,t=>{27!==t.keyCode&&"Escape"!==t.key&&"Esc"!==t.key||l()});var l;const c=o(t.repositionAll,16),d=o(t.resizeAll,16),f=D(t.hover),u=D(t.unhover);return L("touchend",e),L("click",e),L("keyup",a),L("gestureend",c),M("scroll",c),M("resize",d),i("mouseover","[data-footnote-id]",f),i("mouseout","[data-footnote-id]",u),()=>{S("touchend",e),S("click",e),S("keyup",a),S("gestureend",c),k("scroll",c),k("resize",d),n("mouseover","[data-footnote-id]",f),n("mouseout","[data-footnote-id]",u)}}function I(t={}){const e=Object.assign(Object.assign({},A),t),o=function({footnotes:t,unmount:e},o){const n=t=>e=>{e.isReady()&&(e.dismiss(o.dismissCallback),setTimeout(e.remove,t))},i=e=>i=>{o.allowMultiple||t.filter(t=>t.id!==i.id).forEach(n(o.dismissDelay)),i.isReady()&&(i.activate(o.activateCallback),i.reposition(),i.resize(),setTimeout(i.ready,e))},r=e=>o=>{const n=t.find(t=>t.id===o);n&&e(n)};return{activate:(t,e)=>r(i(e))(t),dismiss:(t,e)=>r(n(e))(t),dismissAll:()=>t.forEach(n(o.dismissDelay)),repositionAll:()=>t.forEach(t=>t.reposition()),resizeAll:()=>t.forEach(t=>t.resize()),toggle:r(t=>t.isActive()?n(o.dismissDelay)(t):i(o.activateDelay)(t)),hover:r(t=>{t.startHovering(),o.activateOnHover&&!t.isActive()&&i(o.hoverDelay)(t)}),unhover:r(e=>{e.stopHovering(),o.dismissOnUnhover&&setTimeout(()=>t.filter(t=>!t.isHovered()).forEach(n(o.dismissDelay)),o.hoverDelay)}),unmount:e}}(x(e),e),n=C(o);return{activate(t,n=e.activateDelay){o.activate(t,n)},dismiss(t,n=e.dismissDelay){void 0===t?o.dismissAll():o.dismiss(t,n)},unmount(){n(),o.unmount()},getSetting:t=>e[t],updateSetting(t,o){e[t]=o}}}export default I;export{I as littlefoot};
