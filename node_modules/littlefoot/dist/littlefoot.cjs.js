"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@pacote/get-style"),e=require("@pacote/pixels"),n=require("@pacote/throttle"),o=require("delegated-events"),r=function(){return(r=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function i(t,e){t.classList.add(e)}function a(t,e){t.classList.remove(e)}function c(t){var e;null===(e=t.parentNode)||void 0===e||e.removeChild(t)}function l(t){var e=t.offsetHeight,n=t.getBoundingClientRect().top+e/2;return{top:n,bottom:window.innerHeight-n}}function u(e){var n=parseFloat(t.getStyle(e,"marginLeft")),o=e.offsetWidth-n;return(e.getBoundingClientRect().left+o/2)/window.innerWidth}function s(e,n){var o=2*parseInt(t.getStyle(e,"marginTop"),10)+e.offsetHeight;return n.bottom<o&&n.bottom<n.top?"top":"bottom"}var f=function(t){return!!t.parentElement};function d(n){var o=n.id,r=n.button,d=n.content,v=n.host,p=n.popover,m=n.wrapper,h=!1,g=0;return{id:o,activate:function(n){var o;r.setAttribute("aria-expanded","true"),i(r,"is-changing"),i(r,"is-active"),r.insertAdjacentElement("afterend",p),p.style.maxWidth=document.body.clientWidth+"px",o=d,g=Math.round(e.pixels(t.getStyle(o,"maxHeight"),o)),null==n||n(p,r)},dismiss:function(t){r.setAttribute("aria-expanded","false"),i(r,"is-changing"),a(r,"is-active"),a(p,"is-active"),null==t||t(p,r)},isActive:function(){return r.classList.contains("is-active")},isReady:function(){return!r.classList.contains("is-changing")},isHovered:function(){return h},ready:function(){i(p,"is-active"),a(r,"is-changing")},remove:function(){c(p),a(r,"is-changing")},reposition:function(){f(p)&&(d.style.maxHeight=function(e,n,o){var r=l(n),i=s(e,r),a=parseInt(t.getStyle(e,"marginTop"),10);return Math.min(o,r[i]-a-15)}(p,r,g)+"px",function(t,e){var n=s(t,l(e)),o=t.dataset.footnotePosition;if(o!==n){t.dataset.footnotePosition=n,a(t,"is-positioned-"+o),i(t,"is-positioned-"+n);var r=100*u(e)+"%",c="top"===n?"100%":"0";t.style.transformOrigin=r+" "+c}}(p,r),p.offsetHeight<d.scrollHeight?(i(p,"is-scrollable"),d.setAttribute("tabindex","0")):(a(p,"is-scrollable"),d.removeAttribute("tabindex")))},resize:function(){f(p)&&(p.style.left=function(e,n){var o=e.offsetWidth;return-u(n)*o+parseInt(t.getStyle(n,"marginLeft"),10)+n.offsetWidth/2}(d,r)+"px",m.style.maxWidth=d.offsetWidth+"px",function(t,e){var n=t.querySelector(".littlefoot-footnote__tooltip");n&&(n.style.left=100*u(e)+"%")}(p,r))},startHovering:function(){h=!0},stopHovering:function(){h=!1},destroy:function(){return c(v)}}}function v(t,e){t.addEventListener("wheel",n.throttle(function(t){return function(e){var n=e.currentTarget,o=-e.deltaY;o>0&&a(t,"is-fully-scrolled"),n&&o<=0&&o<n.clientHeight+n.scrollTop-n.scrollHeight&&i(t,"is-fully-scrolled")}}(e),16))}var p=function(t){return i(t,"footnote-print-only")};function m(t,e){return Array.from(t.querySelectorAll(e))}function h(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function g(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild}function y(t){return void 0!==t}function b(t){var e,n,o=(e=t,n=":not(.footnote-print-only)",Array.from(e.children).filter((function(t){return 8!==t.nodeType&&(!n||t.matches(n))}))),r=o.filter((function(t){return"HR"===t.tagName}));o.length===r.length&&(r.concat(t).forEach(p),b(t.parentElement))}function E(t){var e=t.parentElement;c(t);var n=null==e?void 0:e.innerHTML.replace("[]","").replace("&nbsp;"," ").trim();e&&!n&&E(e)}function w(t,e){var n=g(t.body.outerHTML);m(n,'[href$="#'+t.referenceId+'"]').forEach(E);var o=n.innerHTML.trim();return{original:t,data:{id:""+(e+1),number:e+1,reference:"lf-"+t.referenceId,content:o.startsWith("<")?o:"<p>"+o+"</p>"}}}function x(t){var e=/<%=?\s*(\w+?)\s*%>/g;return function(n){return t.replace(e,(function(t,e){var o;return String(null!==(o=n[e])&&void 0!==o?o:"")}))}}function _(t){var e,n,o,i=t.allowDuplicates,c=t.anchorParentSelector,l=t.anchorPattern,u=t.buttonTemplate,s=t.contentTemplate,f=t.footnoteSelector,E=t.numberResetSelector,_=t.scope,H=function(t,e,n){return m(t,n+' a[href*="#"]').filter((function(t){return(t.href+t.rel).match(e)}))}(document,l,_).map(function(t,e,n,o){var r=[];return function(i){var a="#"+i.href.split("#")[1].replace(/[:.+~*[\]]/g,"\\$&"),c=m(t,a).find((function(t){return e||!r.includes(t)})),l=null==c?void 0:c.closest(o);if(l){r.push(l);var u=i.closest(n)||i;return{reference:u,referenceId:u.id||i.id,body:l}}}}(document,i,c,f)).filter(y).map(w).map(E?(e=E,n=0,o=null,function(t){var i=t.original,a=t.data,c=i.reference.closest(e);return n=o===c?n+1:1,o=c,{original:i,data:r(r({},a),{number:n})}}):function(t){return t}).map(function(t,e){var n=x(t),o=x(e);return function(t){var e=t.original,r=t.data,i=r.id,a=g('<span class="littlefoot-footnote__host">'+n(r)+"</span>"),c=a.firstElementChild;c.dataset.footnoteButton="",c.dataset.footnoteId=i,c.dataset.footnoteNumber=""+r.number;var l=g(o(r));l.dataset.footnotePopover="",l.dataset.footnoteId=i;var u=h(l,"littlefoot-footnote__wrapper"),s=h(l,"littlefoot-footnote__content");return v(s,l),{original:e,data:r,id:i,button:c,host:a,popover:l,content:s,wrapper:u}}}(u,s));H.forEach((function(t){var e=t.original,n=t.host;p(e.reference),p(e.body),b(e.body.parentElement),function(t,e){t.insertAdjacentElement("beforebegin",e)}(e.reference,n)}));var A=H.map(d);return{footnotes:A,unmount:function(){A.forEach((function(t){return t.destroy()})),m(document,".footnote-print-only").forEach((function(t){return a(t,"footnote-print-only")}))}}}var H={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:'<aside class="littlefoot-footnote" id="fncontent:<% id %>"><div class="littlefoot-footnote__wrapper"><div class="littlefoot-footnote__content"><% content %></div></div><div class="littlefoot-footnote__tooltip"></div></aside>',buttonTemplate:'<button class="littlefoot-footnote__button littlefoot-footnote__button__ellipsis" id="<% reference %>" title="See Footnote <% number %>" aria-expanded="false"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};var A=function(t,e){return t.target.closest(e)},S=function(t){return null==t?void 0:t.dataset.footnoteId},T=function(t){return function(e){e.preventDefault();var n=A(e,"[data-footnote-id]"),o=S(n);o&&t(o)}},D=document.addEventListener,L=document.removeEventListener,M=window.addEventListener,k=window.removeEventListener;function C(t){var e,r,i,a=(e=t.toggle,r=t.dismissAll,function(t){var n=A(t,"[data-footnote-button]"),o=S(n);o?e(o):A(t,"[data-footnote-popover]")||r()}),c=(i=t.dismissAll,function(t){27!==t.keyCode&&"Escape"!==t.key&&"Esc"!==t.key||i()}),l=n.throttle(t.repositionAll,16),u=n.throttle(t.resizeAll,16),s=T(t.hover),f=T(t.unhover);return D("touchend",a),D("click",a),D("keyup",c),D("gestureend",l),M("scroll",l),M("resize",u),o.on("mouseover","[data-footnote-id]",s),o.on("mouseout","[data-footnote-id]",f),function(){L("touchend",a),L("click",a),L("keyup",c),L("gestureend",l),k("scroll",l),k("resize",u),o.off("mouseover","[data-footnote-id]",s),o.off("mouseout","[data-footnote-id]",f)}}function I(t){void 0===t&&(t={});var e=r(r({},H),t),n=function(t,e){var n=t.footnotes,o=t.unmount,r=function(t){return function(n){n.isReady()&&(n.dismiss(e.dismissCallback),setTimeout(n.remove,t))}},i=function(t){return function(o){e.allowMultiple||n.filter((function(t){return t.id!==o.id})).forEach(r(e.dismissDelay)),o.isReady()&&(o.activate(e.activateCallback),o.reposition(),o.resize(),setTimeout(o.ready,t))}},a=function(t){return function(e){var o=n.find((function(t){return t.id===e}));o&&t(o)}};return{activate:function(t,e){return a(i(e))(t)},dismiss:function(t,e){return a(r(e))(t)},dismissAll:function(){return n.forEach(r(e.dismissDelay))},repositionAll:function(){return n.forEach((function(t){return t.reposition()}))},resizeAll:function(){return n.forEach((function(t){return t.resize()}))},toggle:a((function(t){return t.isActive()?r(e.dismissDelay)(t):i(e.activateDelay)(t)})),hover:a((function(t){t.startHovering(),e.activateOnHover&&!t.isActive()&&i(e.hoverDelay)(t)})),unhover:a((function(t){t.stopHovering(),e.dismissOnUnhover&&setTimeout((function(){return n.filter((function(t){return!t.isHovered()})).forEach(r(e.dismissDelay))}),e.hoverDelay)})),unmount:o}}(_(e),e),o=C(n);return{activate:function(t,o){void 0===o&&(o=e.activateDelay),n.activate(t,o)},dismiss:function(t,o){void 0===o&&(o=e.dismissDelay),void 0===t?n.dismissAll():n.dismiss(t,o)},unmount:function(){o(),n.unmount()},getSetting:function(t){return e[t]},updateSetting:function(t,n){e[t]=n}}}exports.default=I,exports.littlefoot=I;
